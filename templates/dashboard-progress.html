<title>{{ title }} | Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% extends 'base.html' %}

{% block content %}

<main>
	
<!-- =======================
Page Banner START -->
<section class="pt-0">
	<div class="container-fluid px-0">
		<div class="card bg-blue h-100px h-md-200px rounded-0" style="background:url(assets/images/pattern/04.png) no-repeat center center; background-size:cover;">
		</div>
	</div>
	<div class="container mt-n4">
		<div class="row">
			<div class="col-12">
				<div class="card bg-transparent card-body pb-0 ps-0 mt-2 mt-sm-0">
					<div class="row d-sm-flex justify-sm-content-between mt-2 mt-md-0">
						<!-- Avatar -->
						<div class="col-auto">
							<div class="avatar avatar-xxl position-relative mt-n3">
								<img class="avatar-img rounded-circle border border-white border-3 shadow" src="" alt="" id="userprofile3">
								<span class="badge bg-success text-white rounded-pill position-absolute top-50 start-100 translate-middle mt-4 mt-md-5 ms-n3 px-md-3">Pro</span>
							</div>
						</div>
						<!-- Profile info -->
						<div class="col d-sm-flex justify-content-between align-items-center">
							<div>
								<h1 class="my-1 fs-4" id="name1"></h1>
								<ul class="list-inline mb-0">
									<li class="list-inline-item me-3 mb-1 mb-sm-0">
                  
                    <span class="text-body fw-light">points</span>
                  </li>
                  <li class="list-inline-item me-3 mb-1 mb-sm-0">
                    
                    <span class="text-body fw-light">Completed courses</span>
                  </li>
                  <li class="list-inline-item me-3 mb-1 mb-sm-0">
                    <span class="text-body fw-light">Completed lessons</span>
                  </li>
								</ul>
							</div>
							<!-- Button -->
							<div class="mt-2 mt-sm-0">
								<a href="student-course-list.html" class="btn btn-outline-primary mb-0">View my courses</a>
							</div>
						</div>
					</div>
				</div>


				<!-- Divider -->
				<hr class="d-xl-none">
				<div class="col-12 col-xl-3 d-flex justify-content-between align-items-center">
					<a class="h6 mb-0 fw-bold d-xl-none" href="#">Menu</a>
					<button class="btn btn-primary d-xl-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
						<i class="fas fa-sliders-h"></i>
					</button>
				</div>
				<!-- Advanced filter responsive toggler END -->
			</div>
		</div>
	</div>
</section>
<!--Page Banner END -->

<!--Page content START -->
<section class="pt-0">
	<div class="container">
		<div class="row">

			<!-- Right sidebar START -->
			<div class="col-xl-3">
				<!-- Responsive offcanvas body START -->
				<nav class="navbar navbar-light navbar-expand-xl mx-0">
					<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
						<!-- Offcanvas header -->
						<div class="offcanvas-header bg-light">
							<h5 class="offcanvas-title" id="offcanvasNavbarLabel">My profile</h5>
							<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
						</div>
						<!-- Offcanvas body -->
						<div class="offcanvas-body p-3 p-xl-0">
							<div class="bg-dark border rounded-3 pb-0 p-3 w-100">
								<!-- Dashboard menu -->
								<div class="list-group list-group-dark list-group-borderless">
									<a class="list-group-item " href="/student-dashboard"><i class="bi bi-ui-checks-grid fa-fw me-2"></i>Dashboard</a>
									<a class="list-group-item active" href="/student-progress"><i class="bi bi-card-checklist fa-fw me-2"></i>Progress Report</a>
									<a class="list-group-item" href=""><i class="bi bi-card-checklist fa-fw me-2"></i>Learning path</a>
									<a class="list-group-item" href=""><i class="bi bi-basket fa-fw me-2"></i>Courses</a>
											<form action="{{ url_for('auth.logout') }}" method="post">
										<li><a class="list-group-item text-danger bg-danger-soft-hover" href=""><i class="fas fa-sign-out-alt fa-fw me-2"></i><button type="submit" style="background: none;border: none; color: white;">Sign Out</button></a></li>
									</form>
								</div>
							</div>
						</div>
					</div>
				</nav>
				<!-- Responsive offcanvas body END -->
			</div>
			<!-- Right sidebar END -->

			<!-- Main content START -->
			<div class="col-xl-9">

				<!-- Counter boxes START -->
				<div class="row mb-4">
					<!-- Counter item -->
					<div class="col-sm-6 col-lg-4 mb-3 mb-lg-0">
						<div class="d-flex justify-content-center align-items-center p-4 bg-orange bg-opacity-15 rounded-3">
							<span class="display-6 lh-1 text-orange mb-0"><i class="fas fa-tv fa-fw"></i></span>
							<div class="ms-4">
								<div class="d-flex">
									<!-- <h5 class="purecounter mb-0 fw-bold" data-purecounter-start="0" data-purecounter-end="9" data-purecounter-delay="200">0</h5> -->
									<h5 class=" mb-0 fw-bold">0</h5>
								</div>
								<p class="mb-0 h6 fw-light">Total Courses</p>
							</div>
						</div>
					</div>
					<!-- Counter item -->
					<div class="col-sm-6 col-lg-4 mb-3 mb-lg-0">
						<div class="d-flex justify-content-center align-items-center p-4 bg-purple bg-opacity-15 rounded-3">
							<span class="display-6 lh-1 text-purple mb-0"><i class="fas fa-clipboard-check fa-fw"></i></span>
							<div class="ms-4">
								<div class="d-flex">
									<!-- <h5 class="purecounter mb-0 fw-bold" data-purecounter-start="0" data-purecounter-end="52" data-purecounter-delay="200">0</h5> -->
									<h5 class=" mb-0 fw-bold">0</h5>

								</div>
								<p class="mb-0 h6 fw-light">Complete lessons</p>
							</div>
						</div>
					</div>
					<!-- Counter item -->
					<div class="col-sm-6 col-lg-4 mb-3 mb-lg-0">
						<div class="d-flex justify-content-center align-items-center p-4 bg-success bg-opacity-10 rounded-3">
							<span class="display-6 lh-1 text-success mb-0"><i class="fas fa-medal fa-fw"></i></span>
							<div class="ms-4">
								<div class="d-flex">
									<!-- <h5 class="purecounter mb-0 fw-bold" data-purecounter-start="0" data-purecounter-end="8" data-purecounter-delay="300"> </h5> -->
									<h5 class=" mb-0 fw-bold">0</h5>

								</div>
								<p class="mb-0 h6 fw-light">Achieved Certificates</p>
							</div>
						</div>
					</div>
				</div>
				<!-- Counter boxes END -->
				<canvas id="skillsChart" width="400" height="200"></canvas>

</main>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

function getLevelFromRange(value) {
    value = parseInt(value, 10);
    if (value <= 20) return 'Beginner: Basic understanding, little to no practical experience';
    if (value <= 40) return 'Beginner-Intermediate: Some practical experience';
    if (value <= 60) return 'Intermediate: Practical experience and good working knowledge.';
    if (value <= 75) return 'Advanced-Expert: High level of proficiency with hands-on experience';
    if (value <= 95) return 'Expert: Extensive experience and mastery.';
    return 'Advanced';
}

function fetchUserProfile(callback) {
    fetch('/dashboard/student-profile', {
        method: "GET",
        headers: {
            'Content-Type': "application/json"
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('HTTP error! Status: ' + response.status);
        }
        return response.json();
    })
    .then(data => {
        if (data) {
            console.log(data);
            let name1 = document.querySelector("#name1");
            let userprofile3 = document.querySelector("#userprofile3");
            name1.textContent = data.user.name;
            userprofile3.src = data.img_url;

            // Parse skills
            let skills = typeof data.skills === 'string' ? JSON.parse(data.skills) : data.skills;
            callback(skills); // Pass skills to the callback function
        } else {
            console.log('fetch error');
            alert('DB not connected');
        }
    })
    .catch(err => {
        console.error("Fetch error: ", err);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('skillsChart').getContext('2d');

    const chartData = {
        labels: [],
        datasets: [{
            label: 'Skill Level',
            data: [],
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    };

    const skillsChart = new Chart(ctx, {
        type: 'bar',
        data: chartData,
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100, 
                    ticks: {
                        stepSize: 20
                    }
                }
            }
        }
    });

    function updateSkillsChart(skills) {
        if (!skills || skills.length === 0) {
            skills = [{ skill: 'Default Skill', value: '27', date: new Date().toISOString().split('T')[0] }];
        }

        const skillLabels = skills.map(skill => skill.skill + ' (' + skill.date + ')'); 
        const skillValues = skills.map(skill => parseInt(skill.value, 10));

        skillsChart.data.labels = skillLabels;
        skillsChart.data.datasets[0].data = skillValues;
        skillsChart.update();  
    }

    fetchUserProfile(updateSkillsChart);
});


</script>

{% endblock %}